<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q-Explorer</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéµ</text></svg>">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <!-- –ó–ê–ì–†–£–ó–ß–ò–ö -->
    <div id="global-loader">
        <div class="spinner"></div>
    </div>

    <!-- –ü–û–ò–°–ö -->
    <div class="search-container">
        <div class="header">
            <a href="/" class="logo">Q-Explorer <span style="color:var(--primary)">.</span></a>
        </div>
        <form action="/" method="get" class="search-wrapper" onsubmit="saveHistory(this.q.value)">
            <input type="text" name="q" placeholder="Search..." value="{{ query if query else '' }}" autocomplete="off" onfocus="showHistory()">
            <button type="submit">GO</button>
            <div id="history-dropdown"></div>
        </form>
    </div>

    <!-- –ò–ó–ë–†–ê–ù–ù–û–ï -->
    <div id="favorites-section">
        <div class="fav-header">
            <div class="fav-title">‚ù§Ô∏è My Favorites</div>
            <div class="fav-controls">
                <span class="fav-btn-action" onclick="toggleFavsView()" id="fav-toggle-btn">See All</span>
                <span class="fav-btn-action" onclick="clearFavs()">Clear</span>
            </div>
        </div>
        <div id="favorites-container" class="scroll-row"></div>
    </div>

    <!-- –ú–û–î–ê–õ–ö–ê -->
    <div id="music-modal" onclick="closeMusicModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-title">Listen on...</div>
            <a id="modal-spotify" href="#" target="_blank" class="modal-btn m-spotify">Spotify</a>
            <a id="modal-apple" href="#" target="_blank" class="modal-btn m-apple">Apple Music</a>
            <div class="modal-btn m-cancel" onclick="closeMusicModal()">Cancel</div>
        </div>
    </div>

    <!-- HOME -->
    {% if view == 'home' %}
    <div class="empty-state">
        <div style="font-size: 60px; margin-bottom: 20px;">üéµ</div>
        Start searching for music
    </div>
    {% endif %}

    <!-- RESULTS -->
    {% if view == 'results' %}
        
        <!-- Artists -->
        {% if data.artists %}
        <div class="section-header">
            <h2 class="section-title">Artists</h2>
            <a href="/see-all/artists?q={{ query }}" class="btn-see-all">See All</a>
        </div>
        <div class="grid">
            {% for item in data.artists %}
            <a href="/artist/{{ item.artistId }}" class="card artist-card">
                <div class="btn-like" onclick="toggleLike(this, 'artist', '{{ item.artistId }}', '{{ item.artistName|replace('\'', '\\\'') }}', '{{ item.image }}', '{{ item.primaryGenreName }}', '')">‚ô•</div>
                
                <div class="artist-img-wrapper" data-artist-id="{{ item.artistId }}">
                    {% if item.image %}
                        <img src="{{ item.image }}">
                    {% else %}
                        <div class="artist-placeholder" style="background-color: hsl({{ (item.artistName|length * 50) % 360 }}, 60%, 40%);">
                            {{ item.artistName[:1] }}
                        </div>
                    {% endif %}
                </div>
                
                <div class="info">
                    <div class="title">{{ item.artistName }}</div>
                    {% if item.stats %}<span class="artist-stats">{{ item.stats }}</span>{% endif %}
                </div>
            </a>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Albums -->
        {% if data.albums %}
        <div class="section-header">
            <h2 class="section-title">Albums</h2>
            <a href="/see-all/albums?q={{ query }}" class="btn-see-all">See All</a>
        </div>
        <div class="grid">
            {% for item in data.albums %}
            <a href="/album/{{ item.collectionId }}" class="card">
                <div class="btn-like" onclick="toggleLike(this, 'album', '{{ item.collectionId }}', '{{ item.collectionName|replace('\'', '\\\'') }}', '{{ item.artworkUrl100 }}', '{{ item.artistName|replace('\'', '\\\'') }}', '')">‚ô•</div>
                <img src="{{ item.artworkUrl100 }}">
                <div class="info">
                    <div class="title">{{ item.collectionName }}</div>
                    <div class="sub">
                        {{ item.artistName }} 
                        {% if item.year %}‚Ä¢ {{ item.year }}{% endif %}
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Songs -->
        {% if data.songs %}
        <div class="section-header">
            <h2 class="section-title">Songs</h2>
            <a href="/see-all/songs?q={{ query }}" class="btn-see-all">See All</a>
        </div>
        <div class="song-list">
            {% for item in data.songs %}
            <div class="song-row" onclick="openMusicModal('{{ item.spotify_link }}', '{{ item.collectionId }}', '{{ item.trackId }}')">
                <img src="{{ item.artworkUrl100 }}" class="song-img">
                <div class="song-info">
                    <div class="song-title">{{ item.trackName }}</div>
                    <div class="song-artist">{{ item.artistName }}</div>
                </div>
                <div class="song-like btn-like" onclick="toggleLike(this, 'song', '{{ item.trackId }}', '{{ item.trackName|replace('\'', '\\\'') }}', '{{ item.artworkUrl100 }}', '{{ item.artistName|replace('\'', '\\\'') }}', '{{ item.spotify_link }}')">‚ô•</div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    {% endif %}

    <!-- SEE ALL -->
    {% if view == 'see_all' %}
    <div class="page-header">
        <a href="/?q={{ query }}" class="btn-see-all" style="margin-bottom:10px; display:inline-block;">‚Üê Back to Search</a>
        <h1 style="font-size: 24px; margin-bottom: 20px;">All {{ type|capitalize }} for "{{ query }}"</h1>
    </div>
    
    {% if not results %}
        <div style="text-align:center; padding: 40px; color:#666;">No results found.</div>
    {% else %}
    
    {% if type == 'songs' %}
        <div class="song-list">
            {% for item in results %}
             <div class="song-row" onclick="openMusicModal('{{ item.spotify_link }}', '{{ item.collectionId }}', '{{ item.trackId }}')">
                <img src="{{ item.artworkUrl100 }}" class="song-img">
                <div class="song-info">
                    <div class="song-title">{{ item.trackName }}</div>
                    <div class="song-artist">{{ item.artistName }}</div>
                </div>
                <div class="song-like btn-like" onclick="to
