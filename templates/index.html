<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Q-Explorer</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <!-- –®–∞–ø–∫–∞ –∏ –ü–æ–∏—Å–∫ (–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è) -->
    <div class="search-container">
        <div class="header">
            <a href="/" class="logo">Q-Explorer <span style="color:var(--primary)">.</span></a>
        </div>
        <form action="/" method="get" class="search-wrapper" onsubmit="saveHistory(this.q.value)">
            <input type="text" name="q" placeholder="Search artists, albums, songs..." 
                   value="{{ query if query else '' }}" 
                   autocomplete="off" 
                   onfocus="showHistory()">
            <button type="submit">Go</button>
            
            <!-- –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—Ä–∏–∏ -->
            <div id="history-dropdown"></div>
        </form>
    </div>
    <!-- –ö–û–ù–ï–¶ –§–ò–ö–°–ò–†–û–í–ê–ù–ù–û–ô –®–ê–ü–ö–ò -->

    <!-- –ò–ó–ë–†–ê–ù–ù–û–ï (–°–∫—Ä–æ–ª–ª–∏—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π) -->    
    <div id="favorites-section">
        <div class="fav-header">
            <div class="fav-title">‚ù§Ô∏è My Favorites</div>
            <div class="fav-controls">
                <!-- –ö–ª–∞—Å—Å fav-btn-action –¥–µ–ª–∞–µ—Ç –∏—Ö –ø–æ—Ö–æ–∂–∏–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ -->
                <span class="fav-btn-action" onclick="toggleFavsView()" id="fav-toggle-btn">See All</span>
                <span class="fav-btn-action" onclick="clearFavs()">Clear</span>
            </div>
        </div>
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ -->
        <div id="favorites-container" class="scroll-row"></div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å–µ—Ä–≤–∏—Å–∞ -->
    <div id="music-modal" onclick="closeMusicModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-title">Listen on...</div>
            <a id="modal-spotify" href="#" target="_blank" class="modal-btn m-spotify">Spotify</a>
            <a id="modal-apple" href="#" target="_blank" class="modal-btn m-apple">Apple Music</a>
            <div class="modal-btn m-cancel" onclick="closeMusicModal()">Cancel</div>
        </div>
    </div>

    <!-- –ì–õ–ê–í–ù–ê–Ø –°–¢–†–ê–ù–ò–¶–ê -->
    {% if view == 'home' %}
    <div style="text-align: center; margin-top: 100px; color: #666;">
        <div style="font-size: 60px; margin-bottom: 20px;">üéµ</div>
        Search for music to start exploring<br>
        <span style="font-size: 12px; margin-top: 10px; display:block;">Powered by iTunes & Last.fm</span>
    </div>
    {% endif %}

    <!-- –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–ò–°–ö–ê -->
    {% if view == 'results' %}
        
        <!-- Artists -->
        {% if data.artists %}
        <div class="section-header">
            <h2 class="section-title">Artists</h2>
            <a href="/see-all/artists?q={{ query }}" class="btn-see-all">See All</a>
        </div>
        <div class="grid">
            {% for item in data.artists %}
            <a href="/artist/{{ item.artistId }}" class="card artist-card">
                <div class="btn-like" onclick="toggleLike(this, 'artist', '{{ item.artistId }}', '{{ item.artistName|replace('\'', '\\\'') }}', '{{ item.image }}', '{{ item.primaryGenreName }}', '')">‚ô•</div>
                
                {% if item.image %}
                    <img src="{{ item.image }}" loading="lazy">
                {% else %}
                    <div style="width:100%; aspect-ratio:1; background:#333; display:flex; align-items:center; justify-content:center; border-radius:50%; width:80%; margin:10% auto;">üéµ</div>
                {% endif %}
                
                <div class="info">
                    <div class="title">{{ item.artistName }}</div>
                    <div class="sub">{{ item.primaryGenreName }}</div>
                    {% if item.stats %}
                    <div class="stats-container">
                        <span class="artist-stats">{{ item.stats }}</span>
                        <span class="lastfm-tag">Last.fm Data</span>
                    </div>
                    {% endif %}
                </div>
            </a>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Albums -->
        {% if data.albums %}
        <div class="section-header">
            <h2 class="section-title">Albums</h2>
            <a href="/see-all/albums?q={{ query }}" class="btn-see-all">See All</a>
        </div>
        <div class="grid">
            {% for item in data.albums %}
            <a href="/album/{{ item.collectionId }}" class="card">
                <div class="btn-like" onclick="toggleLike(this, 'album', '{{ item.collectionId }}', '{{ item.collectionName|replace('\'', '\\\'') }}', '{{ item.artworkUrl100 }}', '{{ item.artistName|replace('\'', '\\\'') }}', '')">‚ô•</div>
                <img src="{{ item.artworkUrl100 }}" loading="lazy">
                <div class="info">
                    <div class="title">{{ item.collectionName }}</div>
                    <div class="sub">{{ item.artistName }}</div>
                </div>
            </a>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Songs -->
        {% if data.songs %}
        <div class="section-header">
            <h2 class="section-title">Songs</h2>
            <a href="/see-all/songs?q={{ query }}" class="btn-see-all">See All</a>
        </div>
        <div class="song-list">
            {% for item in data.songs %}
            <div class="song-row" onclick="openMusicModal('{{ item.spotify_link }}', '{{ item.collectionId }}', '{{ item.trackId }}')">
                <img src="{{ item.artworkUrl100 }}" class="song-img">
                <div class="song-info">
                    <div class="song-title">{{ item.trackName }}</div>
                    <div class="song-artist">{{ item.artistName }}</div>
                </div>
                <div class="song-like btn-like" onclick="toggleLike(this, 'song', '{{ item.trackId }}', '{{ item.trackName|replace('\'', '\\\'') }}', '{{ item.artworkUrl100 }}', '{{ item.artistName|replace('\'', '\\\'') }}', '{{ item.spotify_link }}')">‚ô•</div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

    {% endif %}

    <!-- –î–ï–¢–ê–õ–ò –ê–†–¢–ò–°–¢–ê -->
    {% if view == 'artist_detail' %}
    <a href="javascript:history.back()" class="btn-see-all" style="margin-bottom:20px; display:inline-block;">‚Üê Back</a>
    
    <div class="artist-hero">
        {% if artist_image %}
            <img src="{{ artist_image }}">
        {% endif %}
        <h1>{{ artist.artistName }}</h1>
        <div class="genre">{{ artist.primaryGenreName }}</div>
        {% if artist.stats %}
            <div style="margin-top:10px; font-weight:bold; color:#eee;">{{ artist.stats }}</div>
            <div class="lastfm-tag">Last.fm Data</div>
        {% endif %}
    </div>

    <!-- –ü–æ—Ö–æ–∂–∏–µ –∞—Ä—Ç–∏—Å—Ç—ã (–ù–û–í–û–ï) -->
    {% if similar %}
    <div class="similar-artists">
        <h3>Fans also like</h3>
        <div class="scroll-row">
            {% for sim in similar %}
            <a href="/?q={{ sim.name }}" class="similar-card">
                <div class="sim-circle">{{ sim.name[:1] }}</div>
                <span>{{ sim.name }}</span>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% for cat, items in discography.items() %}
        {% if items %}
        <div class="section-header">
            <h2 class="section-title">{{ cat|capitalize }}</h2>
        </div>
        <div class="grid">
            {% for item in items %}
            <a href="/album/{{ item.collectionId }}" class="card">
                 <div class="btn-like" onclick="toggleLike(this, 'album', '{{ item.collectionId }}', '{{ item.collectionName|replace('\'', '\\\'') }}', '{{ item.artworkUrl100 }}', '{{ item.artistName|replace('\'', '\\\'') }}', '')">‚ô•</div>
                <img src="{{ item.artworkUrl100 }}" loading="lazy">
                <div class="info">
                    <div class="title">{{ item.collectionName }}</div>
                    <div class="sub">{{ item.releaseDate[:4] }}</div>
                </div>
            </a>
            {% endfor %}
        </div>
        {% endif %}
    {% endfor %}
    {% endif %}

    <!-- –î–ï–¢–ê–õ–ò –ê–õ–¨–ë–û–ú–ê -->
    {% if view == 'album_detail' %}
    <a href="javascript:history.back()" class="btn-see-all" style="margin-bottom:20px; display:inline-block;">‚Üê Back</a>
    
    <div class="hero">
        <img src="{{ album.artworkUrl100 }}">
        <div class="hero-info">
            <h1>{{ album.collectionName }}</h1>
            <div class="sub" style="font-size:16px;">{{ album.artistName }} ‚Ä¢ {{ album.releaseDate[:4] }}</div>
            
            {% if album_stats %}
                <div class="hero-stats">{{ album_stats }}</div>
                <div class="lastfm-tag">LAST.FM</div>
            {% endif %}

            <div class="actions">
                <a href="{{ spotify_link }}" target="_blank" class="btn btn-spotify">Spotify ‚Üó</a>
                <a href="https://music.apple.com/album/{{ album.collectionId }}" target="_blank" class="btn btn-apple">Apple Music ‚Üó</a>
            </div>
        </div>
    </div>

    <div class="song-list" style="margin-top:30px;">
        {% for song in songs %}
        <div class="track" onclick="openMusicModal('{{ song.spotify_link }}', '{{ album.collectionId }}', '{{ song.trackId }}')">
            <div class="t-num">{{ song.trackNumber }}</div>
            <div class="t-name">{{ song.trackName }}</div>
            <div style="color:#666; font-size:12px;">
                {{ (song.trackTimeMillis / 60000) | round | int }}:{{ '%02d' % ((song.trackTimeMillis / 1000) % 60) | int }}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            renderFavorites();
            checkLikedStatus();
        });
    </script>
</body>
</html>
